# Go Downloader Service


Простой HTTP-сервис на Go. Позволяет клиентам отправлять задачи (список URL) и наблюдать за их статусом. Сервис **не использует внешнюю инфраструкту́ру** (БД, Docker, nginx и т.п.). Всё хранится в файловой системе приложения.


## Запуск
1. `go run .` — запустит сервис.
2. По умолчанию слушает `:8080`.


## HTTP API
- `POST /tasks` — создать задачу.
- body JSON: `{ "name": "optional name", "urls": ["http://...", "https://..."] }`
- Ответ: `201` и JSON задачи с `id`.


- `GET /tasks` — список задач (состояния кратко).
- `GET /tasks/{id}` — подробный статус задачи (по каждому файлу).


## Где лежат файлы
- В папке `data/<task-id>/`.
- Временные/частично загруженные файлы называются `<filename>.part`.


## Реализация — важные детали
- Store: `store.go` реализует `Store` с mutex и атомарной перезаписью `tasks.json`.
- Идентификаторы задач генерируются с помощью `crypto/rand`.
- Для каждого файла хранится `status` (`pending`, `in_progress`, `done`, `failed`) и `error` при неудаче.
- Воркеры читают задачи из in-memory очереди (`chan string`) — очередь наполняется при старте сервисa из store и при создании новых задач.
- При старте:
- Загружаем store.
- Перемещаем задачи со статусами `pending` и `in_progress` в очередь (это даёт попытку докачать файлы, которые были в процессе до рестарта).


## Запуск теста
- Curl пример создания задачи:


```bash
curl -X POST http://localhost:8080/tasks \
-H 'Content-Type: application/json' \
-d '{"name":"test","urls":["https://example.com/index.html","https://httpbin.org/image/png"]}'